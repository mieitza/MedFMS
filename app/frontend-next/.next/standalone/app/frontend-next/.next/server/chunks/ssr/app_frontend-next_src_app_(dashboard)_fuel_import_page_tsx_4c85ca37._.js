module.exports=[41188,a=>{"use strict";var b=a.i(3236),c=a.i(91485),d=a.i(52790),e=a.i(73248),f=a.i(13942),g=a.i(51710),h=a.i(54593),i=a.i(64725),j=a.i(9307),k=a.i(21944),l=a.i(26528),m=a.i(94683),n=a.i(61335),o=a.i(96988),p=a.i(10063),q=a.i(943),r=a.i(62186),s=a.i(38121),t=a.i(93473),u=a.i(92402),v=a.i(90654),w=a.i(4393);a.i(50582);var x=a.i(65442);function y(){let a=(0,f.useQueryClient)(),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(!1),G=(0,e.useMutation)({mutationFn:a=>x.fuelApi.importCsv(a),onSuccess:b=>{D(b),b.imported>0&&(n.toast.success(`${b.imported} tranzacții importate cu succes`),a.invalidateQueries({queryKey:["fuel"]})),b.errors.length>0&&n.toast.error(`${b.errors.length} erori la import`)},onError:a=>{n.toast.error(a.message||"Eroare la import")}}),H=(0,c.useCallback)(async a=>{let b=(await a.text()).split("\n").filter(a=>a.trim());if(b.length<2)return void n.toast.error("Fișierul nu conține date");let c=b[0].split(",").map(a=>a.trim().toLowerCase()),d=[];for(let a=1;a<Math.min(b.length,11);a++){let e=b[a].split(",").map(a=>a.trim().replace(/^"|"$/g,"")),f={rowNumber:a+1,isValid:!0,errors:[]};c.forEach((a,b)=>{let c=e[b];a.includes("vehicul")||a.includes("vehicle")||a.includes("nr_auto")?f.vehicleReg=c:a.includes("card")?f.cardNumber=c:a.includes("data")||a.includes("date")?f.transactionDate=c:a.includes("combustibil")||a.includes("fuel")||a.includes("tip")?f.fuelType=c:a.includes("cantitate")||a.includes("quantity")||a.includes("litri")?f.quantity=parseFloat(c)||0:a.includes("valoare")||a.includes("cost")||a.includes("total")?f.totalCost=parseFloat(c)||0:a.includes("km")||a.includes("odometer")?f.odometer=parseInt(c)||0:(a.includes("statie")||a.includes("station"))&&(f.station=c)}),f.vehicleReg||(f.isValid=!1,f.errors.push("Lipsește numărul de înmatriculare")),(!f.quantity||f.quantity<=0)&&(f.isValid=!1,f.errors.push("Cantitate invalidă")),d.push(f)}B(d)},[]),I=(0,c.useCallback)(a=>{if(!a)return;let b=[".xlsx",".xls",".csv"].some(b=>a.name.toLowerCase().endsWith(b));["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(a.type)||b?a.size>0xa00000?n.toast.error("Fișierul este prea mare. Dimensiunea maximă este 10MB."):(z(a),D(null),B([]),a.name.toLowerCase().endsWith(".csv")&&H(a)):n.toast.error("Format de fișier invalid. Acceptăm doar fișiere Excel (.xlsx, .xls) sau CSV.")},[H]),J=(0,c.useCallback)(a=>{a.preventDefault(),F(!0)},[]),K=(0,c.useCallback)(a=>{a.preventDefault(),F(!1)},[]),L=(0,c.useCallback)(a=>{a.preventDefault(),F(!1),I(a.dataTransfer.files[0])},[I]),M=()=>{z(null),B([]),D(null)};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,b.jsxs)(d.default,{href:"/fuel",children:[(0,b.jsx)(o.ArrowLeft,{className:"h-4 w-4 mr-1"}),"Înapoi la Tranzacții"]})})}),(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Import Tranzacții Combustibil"}),(0,b.jsx)("p",{className:"text-slate-500 dark:text-slate-400",children:"Importă tranzacții din fișiere Excel sau CSV"})]}),(0,b.jsxs)(h.Button,{variant:"outline",onClick:()=>{let a=new Blob(["\uFEFFnr_auto,card,data,tip_combustibil,cantitate,valoare,km,statie\nB123ABC,1234567890,2024-01-15,Motorină,50.5,350.00,125000,OMV Pipera"],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a");b.href=URL.createObjectURL(a),b.download="template-import-combustibil.csv",b.click()},children:[(0,b.jsx)(v.Download,{className:"mr-2 h-4 w-4"}),"Descarcă Template"]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(w.FileText,{className:"h-5 w-5"}),"Instrucțiuni"]})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsx)("p",{children:"Fișierul de import trebuie să conțină următoarele coloane:"}),(0,b.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-slate-600 dark:text-slate-400",children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"nr_auto"})," - Numărul de înmatriculare al vehiculului (obligatoriu)"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"card"})," - Numărul cardului de combustibil"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"data"})," - Data tranzacției (format: YYYY-MM-DD)"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"tip_combustibil"})," - Tipul de combustibil"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"cantitate"})," - Cantitatea în litri (obligatoriu)"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"valoare"})," - Valoarea totală în RON"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"km"})," - Kilometrajul la alimentare"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"statie"})," - Numele stației"]})]}),(0,b.jsx)("p",{className:"mt-4 text-slate-500",children:"Formate acceptate: .xlsx, .xls, .csv | Dimensiune maximă: 10MB"})]})})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Încarcă Fișier"})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${E?"border-primary bg-primary/5":"border-slate-200 dark:border-slate-700 hover:border-primary/50"}`,onDragOver:J,onDragLeave:K,onDrop:L,children:y?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,b.jsx)(q.FileSpreadsheet,{className:"h-12 w-12 text-green-600"}),(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("p",{className:"font-medium",children:y.name}),(0,b.jsxs)("p",{className:"text-sm text-slate-500",children:[(y.size/1024).toFixed(2)," KB"]})]})]}),(0,b.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,b.jsx)(h.Button,{variant:"outline",onClick:M,children:"Schimbă Fișierul"}),(0,b.jsxs)(h.Button,{onClick:()=>{y&&G.mutate(y)},disabled:G.isPending,children:[G.isPending&&(0,b.jsx)(u.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),(0,b.jsx)(p.Upload,{className:"mr-2 h-4 w-4"}),"Importă"]})]})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(p.Upload,{className:"h-12 w-12 mx-auto text-slate-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Trage fișierul aici sau click pentru a selecta"}),(0,b.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"Acceptă fișiere Excel (.xlsx, .xls) sau CSV"})]}),(0,b.jsxs)(j.Label,{htmlFor:"file-upload",className:"cursor-pointer",children:[(0,b.jsx)(i.Input,{id:"file-upload",type:"file",accept:".xlsx,.xls,.csv",className:"hidden",onChange:a=>I(a.target.files?.[0]||null)}),(0,b.jsx)(h.Button,{variant:"outline",asChild:!0,children:(0,b.jsx)("span",{children:"Selectează Fișier"})})]})]})})})]}),A.length>0&&!C&&(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Previzualizare Date"}),(0,b.jsxs)(g.CardDescription,{children:["Primele ",A.length," rânduri din fișier"]})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"rounded-md border overflow-x-auto",children:(0,b.jsxs)(l.Table,{children:[(0,b.jsx)(l.TableHeader,{children:(0,b.jsxs)(l.TableRow,{children:[(0,b.jsx)(l.TableHead,{className:"w-12",children:"#"}),(0,b.jsx)(l.TableHead,{children:"Vehicul"}),(0,b.jsx)(l.TableHead,{children:"Card"}),(0,b.jsx)(l.TableHead,{children:"Data"}),(0,b.jsx)(l.TableHead,{children:"Tip"}),(0,b.jsx)(l.TableHead,{className:"text-right",children:"Cantitate"}),(0,b.jsx)(l.TableHead,{className:"text-right",children:"Valoare"}),(0,b.jsx)(l.TableHead,{className:"text-right",children:"KM"}),(0,b.jsx)(l.TableHead,{children:"Stație"}),(0,b.jsx)(l.TableHead,{children:"Status"})]})}),(0,b.jsx)(l.TableBody,{children:A.map(a=>(0,b.jsxs)(l.TableRow,{className:a.isValid?"":"bg-red-50 dark:bg-red-950/20",children:[(0,b.jsx)(l.TableCell,{children:a.rowNumber}),(0,b.jsx)(l.TableCell,{className:"font-medium",children:a.vehicleReg||"-"}),(0,b.jsx)(l.TableCell,{children:a.cardNumber||"-"}),(0,b.jsx)(l.TableCell,{children:a.transactionDate||"-"}),(0,b.jsx)(l.TableCell,{children:a.fuelType||"-"}),(0,b.jsx)(l.TableCell,{className:"text-right",children:a.quantity?.toFixed(2)||"-"}),(0,b.jsx)(l.TableCell,{className:"text-right",children:a.totalCost?.toFixed(2)||"-"}),(0,b.jsx)(l.TableCell,{className:"text-right",children:a.odometer||"-"}),(0,b.jsx)(l.TableCell,{children:a.station||"-"}),(0,b.jsx)(l.TableCell,{children:a.isValid?(0,b.jsxs)(k.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[(0,b.jsx)(r.CheckCircle,{className:"h-3 w-3 mr-1"}),"Valid"]}):(0,b.jsxs)(k.Badge,{variant:"destructive",children:[(0,b.jsx)(s.XCircle,{className:"h-3 w-3 mr-1"}),"Invalid"]})})]},a.rowNumber))})]})})})]}),C&&(0,b.jsxs)("div",{className:"space-y-4",children:[C.imported>0&&(0,b.jsxs)(m.Alert,{className:"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950/30",children:[(0,b.jsx)(r.CheckCircle,{className:"h-4 w-4 text-green-600"}),(0,b.jsx)(m.AlertTitle,{className:"text-green-800 dark:text-green-200",children:"Import Reușit"}),(0,b.jsxs)(m.AlertDescription,{className:"text-green-700 dark:text-green-300",children:[C.imported," tranzacții au fost importate cu succes."]})]}),C.errors.length>0&&(0,b.jsxs)(m.Alert,{variant:"destructive",children:[(0,b.jsx)(t.AlertTriangle,{className:"h-4 w-4"}),(0,b.jsx)(m.AlertTitle,{children:"Erori la Import"}),(0,b.jsx)(m.AlertDescription,{children:(0,b.jsxs)("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[C.errors.slice(0,10).map((a,c)=>(0,b.jsx)("li",{children:a},c)),C.errors.length>10&&(0,b.jsxs)("li",{className:"text-slate-500",children:["... și încă ",C.errors.length-10," erori"]})]})})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(h.Button,{variant:"outline",onClick:M,children:"Import Nou"}),(0,b.jsx)(h.Button,{asChild:!0,children:(0,b.jsx)(d.default,{href:"/fuel",children:"Vezi Tranzacțiile"})})]})]})]})}a.s(["default",()=>y])}];

//# sourceMappingURL=app_frontend-next_src_app_%28dashboard%29_fuel_import_page_tsx_4c85ca37._.js.map